<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/history.js/1.8/bundled-uncompressed/html4+html5/jquery.history.js"></script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta name="description" content="Cloud Elements is an API Integration Platform built for application developers and API publishers">
  <meta name="keywords" content="Cloud Elements, API Documentation, API Integration Platform, API Integration, API Management, Integration Tools">
  <meta name="author" content="Cloud Elements">
  <meta name="google-site-verification" content="RCqiEIyEbmcYtLZRYMOejbAaMr4EhW9jkorS6AbdJ_k" />
  <title>Developer Portal | Cloud Elements</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,400italic" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/assets/font-awesome/css/font-awesome.min.css">
  <link href="/assets/css/toolkit-light.css" rel="stylesheet">
  <link href="/assets/css/docs.css" rel="stylesheet">
  <link href="/assets/css/application.css" rel="stylesheet">
  <link href="/assets/css/custom-styles.css" rel="stylesheet">
  <link rel="canonical" href="https://developers.cloud-elements.com/docs/legacy/formulas/formulaScopes.html">
  <!-- <link href="/api-docs/css/screen.css" media="screen" rel="stylesheet" type="text/css"/> -->
  <!-- <link href="/assets/css/elementDocs.css" rel="stylesheet"> -->
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
<link rel="manifest" href="/favicon/manifest.json">
<link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">

  <style>
  /* note: this is a hack for ios iframe for bootstrap themes shopify page */
  /* this chunk of css is not part of the toolkit :) */
  body {
    width: 1px;
    min-width: 100%;
    *width: 100%;
  }
  </style>
</head>

<body class="with-top-navbar">
  <!-- Main Nav -->
<!-- Include the aloglia light search client from jsdelivr-->
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
<script type="text/javascript">
  let client = algoliasearch('G8W6UO94HX', 'f8dafac4c9e969eecadf7f97f8d3f15f');
  let index = client.initIndex('developer_portal_pages');
  let results;
  function executeSearch(){
    let resultsList = document.getElementById('resultsList');
    resultsList.innerHTML = '';
    let searchTerm = document.getElementById('searchBox').value;
    // Only execute the search if the user has entered at least 3 characters
    if(searchTerm.length >= 3){
      index.search(searchTerm, function searchDone(err, content) {
        // Loop through the results returned by aloglia
        console.log(content);
        content.hits.forEach(element => {
          let listItem = document.createElement('li');
          listItem.setAttribute("class", "resultsItem");
          listItem.innerHTML =
            listItem.innerHTML + '<a class=\'resultItemLink\' href='+element.url+'>' + element.heading + ' | ' + element.title + '</a>' + '<br/>' + element._snippetResult.text.value;
          resultsList.appendChild(listItem);
        })
      });
      $(".searchResultsContainerActive").click(function(e){
        console.log("was clicked");
        console.log(e.target);
        if($(e.target).is("a") || $(e.target).is("div[id='resultsContainer']")){
          let resultsList = document.getElementById('resultsList');
          $(resultsList).empty();
          $("#searchBox").val("");
          document.getElementById("resultsContainer").className = "searchResultsContainer";
        }
      })
    }
    if(searchTerm.length >= 3){
      document.getElementById("resultsContainer").className = "searchResultsContainerActive";
    }
    else{
      document.getElementById("resultsContainer").className = "searchResultsContainer";
    }
  }
</script>
<link href="/assets/css/navbar.css" rel="stylesheet">
<nav class="nav navbar navbar-light navbar-fixed-top">
  <div class="container-fluid navbar-wraper">
    <div class="navbar-header col-md-2">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a id="logo" class="navbar-brand navbar-brand-emphasized" href="http://cloud-elements.com/">
        <img src="/assets/img/cloud-elements-logo.png" alt="Cloud Elements Logo" />
      </a>
    </div>
    <div class="searchBoxContainer col-md-4 hidden-sm hidden-xs">
      <div class="searchBoxWrapper">
        <input
          id="searchBox"
          class="searchBox"
          type="text"
          placeholder="Search the docs..."
          onkeyup="executeSearch()"
          autocomplete="off"
        >
        <span class="icon icon-magnifying-glass"></span>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse col-md-6 float-right">
      <ul class="nav navbar-nav">
        <li>
          <a href="http://status.cloud-elements.com/">Status</a>
        </li>
        <li>
          <a href="https://support.cloud-elements.com/hc/en-us">Support</a>
        </li>
        <li>
          <a href="https://offers.cloud-elements.com/cloud-elements-free-trial-sign-up" target="_blank">
          <button type="button" class="btn btn-lg btn-danger try-it">Try it For Free! <i class="fa fa-caret-right"></i></button>
          </a>
        </li>
      </ul>
    </div>
  </div>
  <div class="searchResultsContainer" id='resultsContainer'>
    <div class="leftPadding col-md-3"> </div>
    <div class="resultsWrapper col-md-6">
      <ul id="resultsList">

      </ul>
    </div>
    <div class="rightPadding col-md-3"></div>
  </div>
  <script>
    // $(document).ready(function(){
    //   console.log('its ready');

    // })
  </script>
</nav>
<!-- END Main Nav -->


  <div class="container-fluid pageContainer">
    <div class="col-md-3 sidebar">
    <link href="/assets/css/sidebar.css" rel="stylesheet">
<link href="/assets/css/release-notes.css" rel="stylesheet">
<script type="text/javascript">
  let currentSelection="";
  // Initialize the expanded menu
  function setCurrentSelection(selection){
    currentSelection = selection;
    document.getElementById(selection).className = "accordionListActive";
  }
  // Accordion List toggle
  function selectAccordion(selection) {
    if(currentSelection != ""){
      document.getElementById(currentSelection).className = "accordionList";
    }
    document.getElementById(selection).className = "accordionListActive";
    currentSelection = selection;
  }
</script>
<div class="sidebarWrapper" id="sidebarWrapper">
</div>
<!-- This section loads in the accordion menu from the sitemap.html file
     Its too expensive to build the site map for each page in the portal -->
<script>
  $(window).on('load',(e) => {
    // Pull in the liquid generated sitemap
    $("#sidebarWrapper").load("/docs/sitemap.html", () =>{
      let pathWithQuery = `${window.location.pathname}${window.location.search}`;
      // Expand the current high level accordion
      let highLevelId = $(`a[href*='${pathWithQuery}']`).closest(`[class*='accordionList']`).attr("id");
      if(highLevelId) setCurrentSelection(highLevelId);
      // Expand the lower level heading
      let currentSelection = $(`a[href*='${pathWithQuery}']`).closest('ul').find('.subItem');
      if(currentSelection) currentSelection.attr('class', 'subItemActive');
      // Create a click listener for sub items
      // Accordion operations
      $(".subHeading").click(function() {
        let selection = $(this).parent().find(".subItem");
        selection.attr('class', 'subItemActive');
        if(currentSelection) currentSelection.attr('class', 'subItem');
        currentSelection = selection;
      });


      // Initialized the highlighting wrapper
      $(`.sidebarWrapper a[href='${pathWithQuery}']`).addClass("activeAccordionLink");
      //Create Click listener for the links
      $(".sidebarWrapper a").click((e)=> {
        $(".activeAccordionLink").removeClass("activeAccordionLink");
        $(e.target).addClass("activeAccordionLink");
      })
    });
  });
</script>

    </div>
    <div class="col-md-9 contentWrapper elementDocContentWrapper">
      <link href="/api-docs/css/screen.css" media="screen" rel="stylesheet" type="text/css"/>
      <link href="/assets/css/elementDocs.css" rel="stylesheet">
      <div class="container-fluid">
        <div class="pageHeading">
          <h2> Formulas </h2>
          <!-- <h4> Understand the scopes different steps produce. </h4> -->
        </div>
        <div class="pageTabs">
          
          
          
          <div class="tab">
            <a href="/docs/legacy/formulas/?elementId=">Overview</a>
          </div>
          
          <div class="tab">
            <a href="/docs/legacy/formulas/definitions.html?elementId=">Definitions</a>
          </div>
          
          <div class="tab">
            <a href="/docs/legacy/formulas/forumulaSteps.html?elementId=">Formula Step Types</a>
          </div>
          
          <div class="tab">
            <a href="/docs/legacy/formulas/firstFormula.html?elementId=">Build Your First Formula</a>
          </div>
          
          <div class="tab">
            <a href="/docs/legacy/formulas/formulaScopes.html?elementId=">Formula Step Scope</a>
          </div>
          
          <div class="tab">
            <a href="/docs/legacy/formulas/examples.html?elementId=">Examples</a>
          </div>
          
          <div class="tab">
            <a href="/docs/legacy/formulas/faqs.html?elementId=">FAQs</a>
          </div>
          
          <div class="tab">
            <a href="/docs/legacy/formulas/api-documentation.html?elementId=">API Documentation</a>
          </div>
          
        </div>
      </div>
      <div class="elementDocContent">
        <div markdown="span" class="bs-callout bs-callout-info">The documentation in this section is for Cloud Elements 1.0. Find Cloud Elements 2.0 documentation at <a href=../../guides/formulasC2/index.html>Building Formulas</a>.</div>

<h1 id="formula-scope">Formula Scope</h1>

<p>Each different type of step produces different step execution values that are added to the formula &quot;context&quot;.  The formula context is then passed from step-to-step, allowing you to use these values in any subsequent steps in your formula.  Below are the different values that each different step type produces:</p>

<blockquote>
<p><strong>NOTE:</strong> Any step execution values that are added to the context are always name-spaced under <code>steps.&lt;your-step-name&gt;</code>.</p>
</blockquote>

<h3 id="elementrequest-or-request-step"><code>elementRequest</code> or <code>request</code> step:</h3>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"my-step-name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{}"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">Name</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">New Account Name</span><span class="se">\"</span><span class="s2">}"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"POST"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{}"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/elements/api-v2/hubs/crm/accounts"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"headers"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">authorization</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">Element /ABC=, User DEF=, Organization GHI</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">content-length</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">14</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">host</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">anysite.io</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">content-type</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">application/json}"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"headers"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">Set-Cookie</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">CESESSIONID=2CA15552EE56EAF65BF1102F6CACEACC;Path=/elements/;HttpOnly</span><span class="se">\"</span><span class="s2">}"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">Id</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">001tx3WcAAI</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">Name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">New Account Name</span><span class="se">\"</span><span class="s2">}"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<h3 id="httprequest-step"><code>httpRequest</code> step:</h3>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"my-step-name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{}"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">Name</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">New Account Name</span><span class="se">\"</span><span class="s2">}"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"POST"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://api.myservice.com:443/myresource"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{}"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"headers"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">authorization</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">mysessionid</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">content-type</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">application/json}"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"headers"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">Set-Cookie</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">CESESSIONID=2CA15552EE56EAF65BF1102F6CACEACC;Path=/elements/;HttpOnly</span><span class="se">\"</span><span class="s2">}"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">id</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">237648</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">My New Resource Name</span><span class="se">\"</span><span class="s2">}"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p><strong>NOTE:</strong> The <code>url</code> attribute is required, the value of which must be a valid <code>http</code> or <code>https</code> URL.</p>
</blockquote>

<h3 id="elementrequeststream-step"><code>elementRequestStream</code> step:</h3>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"my-step-name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"download"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{}"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"POST"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/elements/api-v2/hubs/crm/accounts"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"headers"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">authorization</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">Element /ABC=, User DEF=, Organization GHI</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">content-length</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">14</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">host</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">anysite.io</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">content-type</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">application/json}"</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="s2">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"headers"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">Set-Cookie</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">CESESSIONID=2CA15552EE56EAF65BF1102F6CACEACC;Path=/elements/;HttpOnly</span><span class="se">\"</span><span class="s2">}"</span><span class="w">
          </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"upload"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{}"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"POST"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/elements/api-v2/hubs/crm/accounts"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"headers"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">authorization</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">Element /ABC=, User DEF=, Organization GHI</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">content-length</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">14</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">host</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">anysite.io</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">content-type</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">application/json}"</span><span class="w">
            </span><span class="p">,</span><span class="w">
            </span><span class="s2">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"headers"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">Set-Cookie</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">CESESSIONID=2CA15552EE56EAF65BF1102F6CACEACC;Path=/elements/;HttpOnly</span><span class="se">\"</span><span class="s2">}"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">Id</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">001tx3WcAAI</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">Name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">New Account Name</span><span class="se">\"</span><span class="s2">}"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<h3 id="amqprequest-step"><code>amqpRequest</code> step:</h3>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"my-step-name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">message</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">This is a test message.</span><span class="se">\"</span><span class="s2">}"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"amqp://otqaqsml:tPpXwTl7-iMtezRmyJmD-y2U_XbroYpW@jaguar.rmq.cloudamqp.com/otqaqsml"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"exchange"</span><span class="p">:</span><span class="w"> </span><span class="s2">"main"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"queue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"myqueue"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p><strong>NOTE:</strong> The <code>url</code> and <code>queue</code> attributes are required. The AMQP URL has to adhere to the conventions described in the following document - <a href="https://www.rabbitmq.com/uri-spec.html">https://www.rabbitmq.com/uri-spec.html</a>. If the AMQP request succeeds, the associated <code>onSuccess</code> step is executed, else the <code>onFailure</code> step.</p>
</blockquote>

<h3 id="script-step"><code>script</code> step:</h3>

<p>A script step adds whatever object is passed to the JS <code>done</code> callback onto the formula &quot;context&quot;.  For example, if you have a step named <code>my-script-step</code> that looks like:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">done</span><span class="p">({</span>
  <span class="na">foo</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">,</span>
  <span class="na">object</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">someKey</span><span class="p">:</span> <span class="s1">'someValue'</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>You could now reference <code>steps.my-script-step.foo</code>, <code>steps.my-script-step.object</code> or <code>steps.my-script-step.object.someKey</code> in any subsequent steps when needed.</p>

<h3 id="loop-step"><code>loop</code> step:</h3>

<p>A loop step makes available the current object being processed and the index to each step executed inside of that loop.  For example, if we have a <code>loop</code> step named <code>looper</code>, any steps that are run inside of that loop would have access to <code>looper.index</code> and <code>looper.entry</code>.</p>

<h3 id="filter-or-notification-steps"><code>filter</code> or <code>notification</code> steps:</h3>

<p>These steps simply pass a boolean into the JS <code>done</code> callback function.  That boolean is made available under the key titled <code>continue</code>, for example:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"my-step-name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"continue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p><strong>NOTE:</strong> In the above example, <code>true</code> was passed to the <code>done</code> callback.</p>
</blockquote>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"my-step-name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"continue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p><strong>NOTE:</strong> In the above example, <code>false</code> was passed to the <code>done</code> callback.</p>
</blockquote>

<h3 id="formula-step"><code>formula</code> step:</h3>

<p>These steps execute a sub-formula from the current formula.  The values that are added to the formula context after a <code>formula</code> step finishes executing are whatever the last step that executed in the sub-formula makes available.  Therefore, it&#39;s common practice to have a specific step in the sub-formula that basically aggregates and &quot;returns&quot; whatever data is needed in the parent&#39;s formula context.</p>

<h3 id="retryformulaexecution-step"><code>retryFormulaExecution</code> step:</h3>

<p>Steps of this type truncate the formula execution and schedule a retry execution for a later time based upon the retry attempt number. The equation used to determine the retry time is <code>round(e^x)</code>, where <code>x</code> is the retry attempt number. The result of this equation is used to schedule a retry in minutes. The step execution response value for this step, is a <code>string</code> such as</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"53067"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"retry.error"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Formula instance execution scheduled for retry at approximately 2016-12-05T08:52:37-07:00"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>In the above example, the step name in the formula is <code>retry</code>, and the value of the step execution indicates the time when the formula execution will be retried.</p>

<h2 id="javascript">Javascript</h2>

<p>There are many step types that allow you to write your own custom Javascript.  The function signature for all JS-related step types looks like:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**
 * @param  trigger The trigger that started this execution
 * @param  steps   The list of steps that have been executed up until this point for this execution and all of their step execution values
 * @param  info    Metadata about this formula
 * @param  config  The configuration values set on the formula instance (config variables)
 * @param  done    The callback function that you will need to call at the end of your script step
 */</span>
<span class="kd">function</span> <span class="p">(</span><span class="nx">trigger</span><span class="p">,</span> <span class="nx">steps</span><span class="p">,</span> <span class="nx">info</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// your Javascript will be executed here</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p><strong>PROTIP:</strong> For all scripts, Javascript <code>strict</code> mode is enforced.</p>

<p><strong>PROTIP:</strong> You can use <code>console.log</code> to log things in your formula and help debug.</p>

<p><strong>PROTIP:</strong> You can use <code>notify.email</code> to send an email notification.</p>

<p><strong>PROTIP:</strong> ES6 is supported.</p>

<p><strong>PROTIP:</strong> The function parameters are immutable, meaning they cannot be assigned to directly. In order to change an object or value passed into the function, first copy it to your own local variable and then make the necessary changes.</p>
</blockquote>

<h3 id="additional-functionality">Additional functionality</h3>

<p><strong>Functions</strong></p>

<ul>
<li><code>console.log(str)</code>: Log something from the script. This logged value will be returned in an array called <code>console</code>, which will be available to see as a step execution value. Takes a <code>string</code> as a parameter.</li>
<li><code>throw(str)</code>: Force a script to exit with an error message. The error message will be available to see as a step execution value. Takes a <code>string</code> as a parameter.</li>
<li><code>notify.email(to, subject, body)</code>: Send an email notification directly from a Javascript step.  <code>to</code> can be a single email or a comma separated list of emails, <code>subject</code> is the subject of the email and <code>body</code> is the body of the email. A value will be returned in an array called <code>notify</code>, which will be available to see as a step execution value. Takes three <code>string</code> parameters. You can reference anything from the context when passing in <code>to</code>, <code>subject</code> or <code>body</code> in the same way you can access these variables elsewhere in the Javascript. For example:
<code>
notify.email(steps.previous-step.email, steps.previous-step.subject, steps.previous-step.emailPrefix + &#39;&lt;br&gt;This is the main body.&#39;);
</code></li>
</ul>

<p><strong>Libraries</strong></p>

<ul>
<li>CE: Our custom library that provides some common functionality. It is not necessary to <code>require</code> this library, it is available by default.

<ul>
<li><code>CE.randomString()</code>: Generate a random string (approx. 10 characters long).</li>
<li><code>CE.randomEmail()</code>: Generate a random email address.</li>
<li><code>CE.md5(str)</code>: Create an MD5 hash from a string value. Takes a <code>string</code> as a parameter. Returns a <code>string</code>.</li>
<li><code>CE.b64(str)</code>: Encode a string in base64. Takes a <code>string</code> as a parameter. Returns a <code>string</code>.</li>
<li><code>CE.decode64(str)</code>: Decode a string from base64, using UTF-8 encoding. Takes a <code>string</code> as a parameter. Returns a <code>string</code>.</li>
<li><code>CE.hmac(algo)(enc)(secret, str)</code>: HMAC hash a string (<em>str</em>) using the provided secret (<em>secret</em>), algorithm (<em>algo</em>), and encoding (<em>enc</em>). See <a href="https://nodejs.org/api/crypto.html#crypto_class_hmac">https://nodejs.org/api/crypto.html#crypto_class_hmac</a> for more information about the algorithm and encoding parameters.</li>
<li><code>CE.hmac[algo][enc](secret, str)</code>: This is a set of convenience functions that allow HMAC hashing using some common algorithms and encodings. For example, <code>CE.hmacSha1Hex(secret, str)</code> will create an HMAC SHA1 hash of the provided string, using the provided secret, and return a hex string.  You can replace <em>algo</em> and <em>enc</em> with the following values:
<em>algo</em>: <code>Sha1</code>, <code>Sha256</code>, <code>Md5</code>
<em>enc</em>: <code>Hex</code>, <code>base64</code></li>
</ul></li>
<li>Lodash: The popular <code>lodash</code> library. To use this library, simply <code>require</code> it in your script. It is possible to use the library modules, as well, such as <code>lodash/fp</code>.</li>
<li>Util: The standard Node <code>util</code> library. To use, <code>require</code> it in your script.</li>
</ul>

<h3 id="examples">Examples</h3>

<p>Example <code>trigger</code> object:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"eventId"</span><span class="p">:</span><span class="w"> </span><span class="mi">11211123</span><span class="p">,</span><span class="w">
  </span><span class="s2">"instanceId"</span><span class="p">:</span><span class="w"> </span><span class="mi">231232132</span><span class="p">,</span><span class="w">
  </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"event"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-01T04:09:10Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"elementKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sfdc"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"eventType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UPDATED"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"objectId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"n005i000003sgTd0AAE"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"objectType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Contact"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p><strong>NOTE:</strong> The above <code>trigger</code> example is for an <code>event</code> type trigger.</p>
</blockquote>

<p>Example <code>steps</code> object:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"PreviousStepName"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"StepExecutionKey"</span><span class="p">:</span><span class="w">  </span><span class="s2">"StepExecutionValue"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"AnotherStepExecutionKey"</span><span class="p">:</span><span class="w">  </span><span class="s2">"AnotherStepExecutionValue"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"AnotherPreviousStepName"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"StepExecutionKey"</span><span class="p">:</span><span class="w">  </span><span class="s2">"StepExecutionValue"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p><strong>NOTE:</strong> Each different step type has different step execution values that they will add to the formula &quot;context&quot;.  See above for what each type of step adds to this context.</p>
</blockquote>

<p>Example <code>info</code> object:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="s2">"formulaId"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="s2">"formulaName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my formula name"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"formulaInstanceId"</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span><span class="w">
  </span><span class="s2">"formulaInstanceName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my formula instance name"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"formulaExecutionId"</span><span class="p">:</span><span class="w"> </span><span class="mi">789</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>The <code>done</code> function is simply a callback function that should be called to terminate the given step.  For <code>script</code> type steps, this <code>done</code> callback takes a Javascript object whereas for <code>filter</code> or <code>notification</code> steps, the <code>done</code> callback just takes a <code>boolean</code>.</p>

<h3 id="example-script-step">Example <code>script</code> step:</h3>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">done</span><span class="p">({</span>
  <span class="na">payload</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">subject</span><span class="p">:</span> <span class="s1">'Frozen Yogurt'</span><span class="p">,</span>
    <span class="na">to</span><span class="p">:</span> <span class="s1">'joseph.pulaski@old-school.com'</span><span class="p">,</span>
    <span class="na">from</span><span class="p">:</span> <span class="s1">'frank.ricard@old-school.com'</span><span class="p">,</span>
    <span class="na">message</span><span class="p">:</span> <span class="s1">'Contact '</span> <span class="o">+</span> <span class="nx">trigger</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">objectId</span> <span class="o">+</span> <span class="s1">' was updated!'</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<blockquote>
<p><strong>NOTE:</strong> This is an example script step that is building a JSON payload in order to send an email in a later step.</p>
</blockquote>

<h3 id="example-filter-step">Example <code>filter</code> step:</h3>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">done</span><span class="p">(</span><span class="nx">trigger</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">eventType</span> <span class="o">===</span> <span class="s1">'UPDATED'</span> <span class="o">&amp;&amp;</span> <span class="nx">trigger</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">objectType</span> <span class="o">===</span> <span class="s1">'Contact'</span><span class="p">);</span>
</code></pre></div>
<blockquote>
<p><strong>NOTE:</strong> This is an example <code>filter</code> step that will pass <code>true</code> to our <code>done</code> callback if the event we received in our trigger is from a Contact that was updated in the service that we are listening for events.</p>
</blockquote>

      </div>
      <script type="text/javascript">
        // Init the active tab
        $(`a[href='${window.location.pathname}${window.location.search}']`).parent().addClass("activeTab");
        $(`a[href^='${window.location.pathname}?']`).parent().addClass("activeTab");
        // Toggle the current active tab on the element menu
        $(".tab a").click((e)=> {
          $(".activeTab").removeClass("activeTab");
          $(e.target).parent().addClass("activeTab");
        })
      </script>
    </div>
  </div>
  <script src="/assets/js/tablesorter.min.js"></script>
  <script src="/assets/js/toolkit.js"></script>
  <script src="/assets/js/application.js"></script>
  <!-- /_includes/google_analytics.html -->
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-32342187-1', 'auto');
 //ga('create', 'UA-106858868-1', 'auto');
 ga('send', 'pageview');

</script>

  <!-- Engagio Tracking Script -->
<script type=“text/javascript” charset=“utf-8 ">
var _eiq = _eiq || [];
var _engagio_settings = {
accountId: “572b5582906e828baac61d212c133b568b913200”
};
(function() {
var ei = document.createElement(‘script’); ei.type = ‘text/javascript’; ei.async = true;
ei.src = (‘https:’ == document.location.protocol ? ‘https://’ : ‘http://’) + ‘web-analytics.engagio.com/js/ei.js’;
var s = document.getElementsByTagName(‘script’)[0]; s.parentNode.insertBefore(ei, s);
})();
</script>
  <!-- Start of Async HubSpot Analytics Code -->
 <script type="text/javascript">
   (function(d,s,i,r) {
     if (d.getElementById(i)){return;}
     var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
     n.id=i;n.src='//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/440197.js';
     e.parentNode.insertBefore(n, e);
   })(document,"script","hs-analytics",300000);
 </script>
<!-- End of Async HubSpot Analytics Code -->

  <script src="/assets/js/ajaxLoading.js"></script>
  <script>
  // execute/clear BS loaders for docs
  $(function(){while(window.BS&&window.BS.loader&&window.BS.loader.length){(window.BS.loader.pop())()}})
  </script>
</body>
</html>
